<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="room.css">
    <title>Москва</title>
</head>
<body>

    <h1>Москва</h1>
    <div class="container4" style="margin-block-end: 20px;">
        <div class="container1">
            <div class="locker tooltip phone" id="1">
                
                <span class="tooltip-text"></span>
            </div>
            <div class="locker tooltip phone" id="2">
                
                <span class="tooltip-text"></span>
            </div>
            <div class="locker tooltip phone" id="3">
                
                <span class="tooltip-text"></span>
            </div>
        </div>
        <div class="container1">
            <div class="locker tooltip phone" id="4">
                
                <span class="tooltip-text"></span>
            </div>
            <div class="locker tooltip phone" id="5">
                
                <span class="tooltip-text"></span>
            </div>
            <div class="locker tooltip phone" id="6">
                
                <span class="tooltip-text"></span>
            </div>
            <div class="locker tooltip phone" id="7">
                
                <span class="tooltip-text"></span>
            </div>
        </div>
    </div>

    <div class="container5">
        <div class="container1">
            <div class="locker tooltip phone" id="8">
                983-1125
                <span class="tooltip-text">983-1125</span>
            </div>
            <div class="locker tooltip phone" id="9">
                1126-1271
                <span class="tooltip-text">1126-1271</span>
            </div>
            <div class="locker tooltip phone" id="10">
                1272-1420
                <span class="tooltip-text">1272-1420</span>
            </div>
            <div class="locker tooltip phone" id="11">
                1421-1573
                <span class="tooltip-text">1421-1573</span>
            </div>
            <div class="locker tooltip phone" id="12">
                1574-1719
                <span class="tooltip-text">1574-1719</span>
            </div>
        </div>

        <div class="container1">
            <div class="locker tooltip phone" id="13">
                2345-2514
                <span class="tooltip-text">2345-2514</span>
            </div>
            <div class="locker tooltip phone" id="14">
                2186-2344
                <span class="tooltip-text">2186-2344</span>
            </div>
            <div class="locker tooltip phone" id="15">
                2034-2185
                <span class="tooltip-text">2034-2185</span>
            </div>
            <div class="locker tooltip phone" id="16">
                1876-2033
                <span class="tooltip-text">1876-2033</span>
            </div>
            <div class="locker tooltip phone" id="17">
                1720-1875
                <span class="tooltip-text">1720-1875</span>
            </div>
        </div>
    </div>

    <div class="container5">
        <div class="container1">
            <div class="locker tooltip phone" id="18">
                3175-3338
                <span class="tooltip-text">3175-3338</span>
            </div>
            <div class="locker tooltip phone" id="19">
                3008-3174
                <span class="tooltip-text">3008-3174</span>
            </div>
            <div class="locker tooltip phone" id="20">
                2854-3007
                <span class="tooltip-text">2854-3007</span>
            </div>
            <div class="locker tooltip phone" id="21">
                2684-2853
                <span class="tooltip-text">2684-2853</span>
            </div>
            <div class="locker tooltip phone" id="22">
                2515-2683
                <span class="tooltip-text">2515-2683</span>
            </div>
        </div>

        <div class="container1">
            <div class="locker tooltip phone" id="23">
                3985-4142
                <span class="tooltip-text">3985-4142</span>
            </div>
            <div class="locker tooltip phone" id="24">
                3819-3984
                <span class="tooltip-text">3819-3984</span>
            </div>
            <div class="locker tooltip phone" id="25">
                3669-3818
                <span class="tooltip-text">3669-3818</span>
            </div>
            <div class="locker tooltip phone" id="26">
                3515-3668
                <span class="tooltip-text">3515-3668</span>
            </div>
            <div class="locker tooltip phone" id="27">
                3339-3514
                <span class="tooltip-text">3339-3514</span>
            </div>
        </div>
    </div>

    <div class="container5">
        <div class="container4">
            <div class="container1">
                <div class="locker tooltip phone" id="28">
                    4833-5089
                    <span class="tooltip-text">4833-5089</span>
                </div>
                <div class="locker tooltip phone" id="29">
                    4648-4832
                    <span class="tooltip-text">4648-4832</span>
                </div>
                <div class="locker tooltip phone" id="30">
                    4480-4647
                    <span class="tooltip-text">4480-4647</span>
                </div>
                <div class="locker tooltip phone" id="31">
                    4307-4479
                    <span class="tooltip-text">4307-4479</span>
                </div>
                <div class="locker tooltip phone" id="32">
                    4143-4306
                    <span class="tooltip-text">4143-4306</span>
                </div>
            </div>
    
            <div class="container1">
                <div class="locker tooltip phone" id="33">
                    10026-10210
                    <span class="tooltip-text">10026-10210</span>
                </div>
                <div class="locker tooltip phone" id="34">
                    9795-10025
                    <span class="tooltip-text">9795-10025</span>
                </div>
                <div class="locker tooltip phone" id="35">
                    9625-9794
                    <span class="tooltip-text">9625-9794</span>
                </div>
            </div>
        </div>
        
        <div class="container4">
            <div class="container1">
                <div class="locker tooltip phone" id="36">
                    6149-6358
                    <span class="tooltip-text">6149-6358</span>
                </div>
                <div class="locker tooltip phone" id="37">
                    5974-6148
                    <span class="tooltip-text">5974-6148</span>
                </div>
                <div class="locker tooltip phone" id="38">
                    5714-5973
                    <span class="tooltip-text">5714-5973</span>
                </div>
                <div class="locker tooltip phone" id="39">
                    5408-5713
                    <span class="tooltip-text">5408-5713</span>
                </div>
                <div class="locker tooltip phone" id="40">
                    5090-5407
                    <span class="tooltip-text">5090-5407</span>
                </div>
            </div>
    
            <div class="container1">
                <div class="locker tooltip phone" id="41">
                    10211-10381
                    <span class="tooltip-text">10211-10381</span>
                </div>
                <div class="locker tooltip phone" id="42">
                    10382-10566
                    <span class="tooltip-text">10382-10566</span>
                </div>
                <div class="locker tooltip phone" id="43">
                    10567-10644
                    <span class="tooltip-text">10567-10644</span>
                </div>
                <div class="locker tooltip phone" id="44">
                    10776-10969
                    <span class="tooltip-text">10776-10969</span>
                </div>
            </div>
        </div>

    </div>

    <div class="container5">
        <div class="container4">
            <div class="container1">
                <div class="locker tooltip phone" id="45">
                    7204-7447
                    <span class="tooltip-text">7204-7447</span>
                </div>
                <div class="locker tooltip phone" id="46">
                    6983-7203
                    <span class="tooltip-text">6983-7203</span>
                </div>
                <div class="locker tooltip phone" id="47">
                    6776-6982
                    <span class="tooltip-text">6776-6982</span>
                </div>
                <div class="locker tooltip phone" id="48">
                    6571-6775
                    <span class="tooltip-text">6571-6775</span>
                </div>
                <div class="locker tooltip phone" id="49">
                    6359-6570
                    <span class="tooltip-text">6359-6570</span>
                </div>
            </div>
    
            <div class="container1">
                <div class="locker tooltip phone" id="50">
                    15260-15372
                    <span class="tooltip-text">15260-15372</span>
                </div>
                <div class="locker tooltip phone" id="51">
                    15155-15259
                    <span class="tooltip-text">15155-15259</span>
                </div>
                <div class="locker tooltip phone" id="52">
                    15036-15154
                    <span class="tooltip-text">15036-15154</span>
                </div>
                <div class="locker tooltip phone" id="53">
                    14903-15035
                    <span class="tooltip-text">14903-15035</span>
                </div>
                <div class="locker tooltip phone" id="54">
                    14775-14902
                    <span class="tooltip-text">14775-14902</span>
                </div>
            </div>
        </div>
        
        <div class="container4">
            <div class="container1">
                <div class="locker tooltip phone" id="55">
                    8330-8533
                    <span class="tooltip-text">8330-8533</span>
                </div>
                <div class="locker tooltip phone" id="56">
                    8135-8329
                    <span class="tooltip-text">8135-8329</span>
                </div>
                <div class="locker tooltip phone" id="57">
                    7912-8134
                    <span class="tooltip-text">7912-8134</span>
                </div>
                <div class="locker tooltip phone" id="58">
                    7678-7911
                    <span class="tooltip-text">7678-7911</span>
                </div>
                <div class="locker tooltip phone" id="59">
                    7448-7677
                    <span class="tooltip-text">7448-7677</span>
                </div>
            </div>
    
            <div class="container1">
                <div class="locker tooltip phone" id="60">
                    15373-15501
                    <span class="tooltip-text">15373-15501</span>
                </div>
                <div class="locker tooltip phone" id="61">
                    15503-15683
                    <span class="tooltip-text">15503-15683</span>
                </div>
                <div class="locker tooltip phone" id="62">
                    10971-11139
                    <span class="tooltip-text">10971-11139</span>
                </div>
                <div class="locker tooltip phone" id="63">
                    11140-11296
                    <span class="tooltip-text">11140-11296</span>
                </div>
                <div class="locker tooltip phone" id="64">
                    11297-11516
                    <span class="tooltip-text">11297-11516</span>
                </div>
            </div>
        </div>

    </div>

    <div class="container6">
        <div class="locker tooltip phone" id="65">
            9424-9624
            <span class="tooltip-text">9424-9624</span>
        </div>
        <div class="locker tooltip phone" id="66">
            9205-9423
            <span class="tooltip-text">9205-9423</span>
        </div>
        <div class="locker tooltip phone" id="67">
            8999-9204
            <span class="tooltip-text">8999-9204</span>
        </div>
        <div class="locker tooltip phone" id="68">
            8762-8998
            <span class="tooltip-text">8762-8998</span>
        </div>
        <div class="locker tooltip phone" id="69">
            8534-8761
            <span class="tooltip-text">8534-8761</span>
        </div>
    </div>
    
    <div class="container7">
        <div class="container1">
            <div class="locker tooltip phone" id="70">
                15631-15778
                <span class="tooltip-text">15631-15778</span>
            </div>
            <div class="locker tooltip phone" id="71">
                15779-15955
                <span class="tooltip-text">15779-15955</span>
            </div>
            <div class="locker tooltip phone" id="72">
                12478-12625
                <span class="tooltip-text">12478-12625</span>
            </div>
            <div class="locker tooltip phone" id="73">
                12339-12477
                <span class="tooltip-text">12339-12477</span>
            </div>
            <div class="locker tooltip phone" id="74">
                12183-12338
                <span class="tooltip-text">12183-12338</span>
            </div>
            <div class="locker tooltip phone" id="75">
                12025-12182
                <span class="tooltip-text">12025-12182</span>
            </div>
            <div class="locker tooltip phone" id="76">
                11866-12024
                <span class="tooltip-text">11866-12024</span>
            </div>
            <div class="locker tooltip phone" id="77">
                11704-11865
                <span class="tooltip-text">11704-11865</span>
            </div>
            <div class="locker tooltip phone" id="78">
                11517-11703
                <span class="tooltip-text">11517-11703</span>
            </div>
        </div>
    
        <div class="container1">
            <div class="locker tooltip phone" id="79">
                13843-13979
                <span class="tooltip-text">13843-13979</span>
            </div>
            <div class="locker tooltip phone" id="80">
                13980-14103
                <span class="tooltip-text">13980-14103</span>
            </div>
            <div class="locker tooltip phone" id="81">
                14104-14245
                <span class="tooltip-text">14104-14245</span>
            </div>
            <div class="locker tooltip phone" id="82">
                14246-14388
                <span class="tooltip-text">14246-14388</span>
            </div>
            <div class="locker tooltip phone" id="83">
                14389-14508
                <span class="tooltip-text">14389-14508</span>
            </div>
            <div class="locker tooltip phone" id="84">
                14508-14656
                <span class="tooltip-text">14508-14656</span>
            </div>
            <div class="locker tooltip phone" id="85">
                14657-14751
                <span class="tooltip-text">14657-14751</span>
            </div>
            <div class="locker tooltip phone" id="86">
                Пусто
                <span class="tooltip-text">Пусто</span>
            </div>
        </div>
    </div>
    
    <div class="container8">
        <div class="locker tooltip phone" id="87">
            Пусто
            <span class="tooltip-text">Пусто</span>
        </div>
        <div class="locker tooltip phone" id="88">
            13714-13842
            <span class="tooltip-text">13714-13842</span>
        </div>
        <div class="locker tooltip phone" id="89">
            13567-13713
            <span class="tooltip-text">13567-13713</span>
        </div>
        <div class="locker tooltip phone" id="90">
            13424-13566
            <span class="tooltip-text">13424-13566</span>
        </div>
        <div class="locker tooltip phone" id="91">
            13292-13423
            <span class="tooltip-text">13292-13423</span>
        </div>
        <div class="locker tooltip phone" id="92">
            13143-13291
            <span class="tooltip-text">13143-13291</span>
        </div>
        <div class="locker tooltip phone" id="93">
            13010-13142
            <span class="tooltip-text">13010-13142</span>
        </div>
        <div class="locker tooltip phone" id="94">
            12892-13009
            <span class="tooltip-text">12892-13009</span>
        </div>
        <div class="locker tooltip phone" id="95">
            12755-12891
            <span class="tooltip-text">12755-12891</span>
        </div>
        <div class="locker tooltip phone" id="96">
            12626-12754
            <span class="tooltip-text">12626-12754</span>
        </div>
    </div>

    <div class="container3">
        <button id="button1" style="display: block;">Изменить диапазон</button>
        <button id="button2" style="display: none;">Готово</button>
        <button id="buttonSearch" style="display: block;">Найти папку</button>
      <button id="buttonMenu" style="display: block;">В меню</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";

        const firebaseConfig = {
          apiKey: "AIzaSyAHnK-FVrEpoPT78-QLN4YNEjwLOKDqx_w",
          authDomain: "test-af4e9.firebaseapp.com",
          databaseURL: "https://test-af4e9-default-rtdb.firebaseio.com",
          projectId: "test-af4e9",
          storageBucket: "test-af4e9.appspot.com",
          messagingSenderId: "78974433240",
          appId: "1:78974433240:web:8fcb051e58814fdd4124ad"
        };

        const app = initializeApp(firebaseConfig);
        import { getDatabase, get, set, remove, update, ref, onValue } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";
        const database = getDatabase();

        function fillDataFromDatabase() {
            const lockers = document.querySelectorAll(".locker");
            lockers.forEach((locker) => {
                const id = locker.id;
                var spanElement = locker.querySelector('span');
                const lockerRef = ref(database, "room3/" + id);

                onValue(lockerRef, (snapshot) => {
                    const data = snapshot.val();
                    if(spanElement.className=="tooltip-text"){
                        locker.innerHTML = data + '<span class="tooltip-text">' + data + '</span>';
                    }else{
                        locker.innerHTML = data + '<span class="tooltip-text2">' + data + '</span>';
                    }
                });
            });
        }
        
        fillDataFromDatabase();

        const stringValue = localStorage.getItem('number');
        const value = parseInt(stringValue.replace(/\D/g, ''), 10);

        const divElements = document.getElementsByClassName('locker');

        onValue(ref(database, "room3/"), function(snapshot) {
            snapshot.forEach(function(childSnapshot) {
                var key = childSnapshot.key;
                var data = childSnapshot.val();
                const match = data.match(/\d+-\d+/);
                if (match) {
                    const range = match[0];

                    const numberToFind = value;
                    if (isInRange(numberToFind, range)) {
                        var divElement = document.getElementById(key);
                        if (divElement) {
                            divElement.style.backgroundColor = 'green';
                        }
                        return; // Остановить итерацию
                    }
                }
            });
        });

        function isInRange(number, range) {
            const [start, end] = range.split('-');
            return number >= start && number <= end;
        }

        var phones = document.querySelectorAll('.phone');
        var button1 = document.getElementById('button1');
        var button2 = document.getElementById('button2');
        var buttonMenu = document.getElementById('buttonMenu');
        var buttonSearch = document.getElementById('buttonSearch');
        var state = false;
        var selectedCells = [];

        button1.addEventListener('click', function() {
            button1.style.display = 'none';
            button2.style.display = 'block';
            state = true;
        });

        button2.addEventListener('click', function() {
            button1.style.display = 'block';
            button2.style.display = 'none';
            state = false;
            removeSelectedCells();
        });

        buttonMenu.addEventListener('click', function() {
            window.location.href = "../menu.html";
        });

        buttonSearch.addEventListener('click', function() {
            window.location.href = "../findDoc.html";
        });

        phones.forEach(function(phone) {
            phone.addEventListener('touchstart', handleCellClick);
            phone.addEventListener('mousedown', handleCellClick);

            phone.addEventListener('touchend', handleCellRelease);
            phone.addEventListener('mouseup', handleCellRelease);
        });

        function handleCellClick(event) {
            if (state) {
                var selectedDiv = event.target;
                var divId = selectedDiv.id;

                var number1 = promptAndParseInteger('Введите первое число');
                while (!Number.isInteger(number1) || number1<0) {
                    number1 = promptAndParseInteger('Введенное значение должно быть целым неотрицательным числом. Введите начало диапазона');
                }

                var number2 = promptAndParseInteger('Введите второе число');
                while (!Number.isInteger(number2) || number2<0) {
                    number2 = promptAndParseInteger('Введенное значение должно быть целым неотрицательным числом. Введите конец диапазона');
                }
                
                var str = number1+"-"+number2;
                const key = divId;
                const nodeRef = ref(database, "room3/");

                update(nodeRef, {[key]: str })
                .then(() => {
                    alert("Значение успешно обновлено!");
                })
                .catch((error) => {
                    alert("Ошибка при обновлении значения:", error);
                });

                var divElement = document.getElementById(divId);
                divElement.classList.add('touch');
                selectedCells.push(selectedDiv);
            }
        }

        function handleCellRelease(event) {
            var selectedDiv = event.target;
            var divElement = document.getElementById(selectedDiv.id);
            divElement.classList.remove('touch');
            removeSelectedCells();
        }

        function promptAndParseInteger(message) {
            var input = prompt(message);
            return parseInt(input);
        }

        function removeSelectedCells() {
            selectedCells.forEach(function(cell) {
                cell.classList.remove('touch');
            });
            selectedCells = [];
        }
    </script>

</body>
</html>

